(self.AMP=self.AMP||[]).push({m:0,v:"2111060251009",n:"amp-geo",ev:"0.1",l:true,f:function(AMP,_){"use strict";var f="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b};function g(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var d=b[c];if(d&&d.Math==Math)return}(function(){throw Error("Cannot find global object")})()}g(this);"function"===typeof Symbol&&Symbol("x");var h;if("function"==typeof Object.setPrototypeOf)h=Object.setPrototypeOf;else{var n;a:{var p={a:!0},q={};try{q.__proto__=p;n=q.a;break a}catch(a){}n=!1}h=n?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var u,t=h;var v=Object.prototype.toString;var w=Array.isArray;function x(a,b){try{return JSON.parse(a)}catch(c){return null==b||b(c),null}}
/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function y(a){var b;return"SCRIPT"==a.tagName&&"APPLICATION/JSON"==(null==(b=a.getAttribute("type"))?void 0:b.toUpperCase())}var z=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function D(a,b){var c=b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(d){return c}}function E(a){a=(a||self).location;a=a.originalHash||a.hash;var b=Object.create(null);if(a)for(var c;c=z.exec(a);){var d=D(c[1],c[1]);c=c[2]?D(c[2].replace(/\+/g," "),c[2]):"";b[d]=c}return b}var F=self.AMP_CONFIG||{},G=("string"==typeof F.cdnProxyRegex?new RegExp(F.cdnProxyRegex):F.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function H(a){if(!self.document||!self.document.head||self.location&&G.test(self.location.origin))return null;var b=self.document.head.querySelector('meta[name="'+a+'"]');return b&&b.getAttribute("content")||null}var I={thirdParty:F.thirdPartyUrl||"https://3p.ampproject.net",thirdPartyFrameHost:F.thirdPartyFrameHost||"ampproject.net",thirdPartyFrameRegex:("string"==typeof F.thirdPartyFrameRegex?new RegExp(F.thirdPartyFrameRegex):F.thirdPartyFrameRegex)||/^d-\d+\.ampproject\.net$/,cdn:F.cdnUrl||H("runtime-host")||"https://cdn.ampproject.org",cdnProxyRegex:G,localhostRegex:/^https?:\/\/localhost(:\d+)?$/,errorReporting:F.errorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r",betaErrorReporting:F.betaErrorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r-beta",localDev:F.localDev||!1,trustedViewerHosts:[/(^|\.)google\.(com?|[a-z]{2}|com?\.[a-z]{2}|cat)$/,/(^|\.)gmail\.(com|dev)$/],geoApi:F.geoApiUrl||H("amp-geo-api")};self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var J=self.__AMP_LOG;function K(){throw Error("failed to call initLogConstructor")}function L(){J.user||(J.user=K());return J.user}function M(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return N(a,b)}function O(a){a=P(a);a=P(a);a=a.isSingleDoc()?a.win:a;return Q(a,"url")?N(a,"url"):null}function P(a){return a.nodeType?M((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function N(a,b){Q(a,b);var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function Q(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor)}function R(a){var b;return!(null==(b=a.AMP_CONFIG)||!b.canary)}var S={"preset-eea":"AT BE BG HR CY CZ DK EE FI FR DE GR HU IS IE IT LV LI LT LU MT NL NO PL PT RO SK SI ES SE GB AX IC EA GF PF TF GI GP GG JE MQ YT NC RE BL MF PM SJ VA WF EZ CH".split(" "),"preset-us-ca":["us-ca"]};var aa=/amp-iso-country-(\w+)/,T=/^(?:(\w{2})(?:\s(\w{2}-\w{2}))?)?\s*/;function U(a){a=AMP.BaseElement.call(this,a)||this;a.o=0;a.C=!1;a.h="unknown";a.B="unknown";a.j=[];a.A=[];return a}var V=AMP.BaseElement;U.prototype=f(V.prototype);U.prototype.constructor=U;if(t)t(U,V);else for(var W in V)if("prototype"!=W)if(Object.defineProperties){var X=Object.getOwnPropertyDescriptor(V,W);X&&Object.defineProperty(U,W,X)}else U[W]=V[W];U.D=V.prototype;U.prerenderAllowed=function(){return!0};U.prototype.buildCallback=function(){var a=this.element.children;a.length&&Y(1===a.length&&y(a[0]),'amp-geo can only have one <script type="application/json"> child');a=a.length?x(a[0].textContent,(function(){return Y(!1,"amp-geo Unable to parse JSON")})):{};var b=ba(this,a||{});Z.resolve(b)};function Y(a,b){return a?a:(Z.resolve(null),L().assert(a,b,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0))}function ca(a,b){var c=b.getBody().className.match(aa),d=T.exec("gb                          "),e=E(a.win)["amp-geo"];if(e&&R(a.win)){var k=T.exec(e.toLowerCase());k[1]&&(a.h=k[1],k[2]&&(a.B=k[2]),a.o=2)}else c&&!O(a.element).isProxyOrigin(a.win.location)?(a.o=1,a.h=c[1]):d[1]?(a.o=0,a.h=d[1].toLowerCase(),d[2]&&"us-ca"===d[2].toLowerCase()&&(a.B="us-ca")):""===d[0]&&I.geoApi?a.o=3:""===d[0]&&(a.C=!0,(J.dev||(J.dev=K())).error("amp-geo","GEONOTPATCHED: amp-geo served unpatched, ISO country not set"));3!==a.o?(u||(u=Promise.resolve(void 0)),b=u):b=da(a).then((function(l){if(l){var m=l.country,r=l.subdivision;a.h=m;r&&"us-ca"===m+"-"+r&&(a.B="us-ca")}else a.C=!0,(J.dev||(J.dev=K())).error("amp-geo","GEONOTPATCHED: amp-geo served unpatched and API response not valid, ISO country not set")}));return b}function ea(a){var b=I.geoApi;return"string"!==typeof b?(L().error("amp-geo","geoApiUrl must be a string URL"),null):O(a.element).isSecure(b)?b:(L().error("amp-geo","geoApiUrl must be secure (https)"),null)}function da(a){var b=ea(a);if(!b)return Promise.resolve(null);L().info("amp-geo","API request is being used for country, this may result in FOUC");return N(a.win,"timer").timeoutPromise(6e4,M(a.win,"xhr").fetchJson(b,{mode:"cors",method:"GET",credentials:"omit"}).then((function(c){return c.json()})).then((function(c){return/^[a-z]{2}$/i.test(c.country)?{country:c.country.toLowerCase(),subdivision:/^[a-z0-9]{1,3}$/i.test(c.subdivision)?c.subdivision.toLowerCase():null}:(L().error("amp-geo",'Invalid API response, expected schema not matched for property "country"'),null)})).catch((function(c){L().error("amp-geo","XHR country request failed",c);return null})),"Timeout (60 sec) reached waiting for API response").catch((function(c){L().error("amp-geo",c);return null}))}function fa(a,b){var c=b.ISOCountryGroups;c&&(Y("[object Object]"===v.call(c),"<amp-geo> ISOCountryGroups must be an object"),a.A=Object.keys(c),a.A.forEach((function(d){Y(/^[a-z]+[a-z0-9]*$/i.test(d)&&!/^amp/.test(d),"<amp-geo> ISOCountryGroups["+d+"] name is invalid");Y(w(c[d]),"<amp-geo> ISOCountryGroups["+d+"] must be an array");ha(a,c[d])&&a.j.push(d)})))}function ha(a,b){var c=b.reduce((function(d,e){if(/^preset-/.test(e))return Y(w(S[e]),"<amp-geo> preset "+e+" not found"),d.concat(S[e]);"unknown"==e||/^[a-zA-Z]{2}$/.test(e)?d.push(e):L().error("amp-geo"," country %s not valid, will be ignored",e);return d}),[]).map((function(d){return d.toLowerCase()}));return c.includes(a.h)||c.includes("us-ca")&&"us-ca"==a.B}function ia(a){var b=a.classList,c=[],d=/^amp-iso-country-|^amp-geo-group-/i;for(a=b.length-1;0<a;a--)d.test(b[a])&&c.push(b[a]);return c}function ba(a,b){var c=a.getAmpDoc(),d={};return c.whenReady().then((function(){return c.waitForBodyOpen()})).then((function(e){return ca(a,c).then((function(){return e}))})).then((function(e){fa(a,b);var k=[];switch(a.o){case 2:k=ia(e);case 0:case 3:d.ISOCountry=a.h;var l=a.j.map((function(m){d[m]=!0;return"amp-geo-group-"+m}));a.j.length||l.push("amp-geo-no-group");a.C&&l.push("amp-geo-error");d.ISOCountryGroups=a.j;l.push("amp-iso-country-"+a.h);a.mutateElement((function(){var m=e.classList;k.push("amp-geo-pending");k.forEach((function(A){m.remove(A)}));l.forEach((function(A){return m.add(A)}));if(b.AmpBind){var r=c.getElementById("ampGeo");r&&r.parentNode.removeChild(r);var B=c.win.document.createElement("amp-state"),C=c.win.document.createElement("script");C.setAttribute("type","application/json");C.textContent=JSON.stringify(d);B.appendChild(C);B.id="ampGeo";e.appendChild(B)}}),e)}return{ISOCountry:a.h,matchedISOCountryGroups:a.j,allISOCountryGroups:a.A,isInCountryGroup:a.isInCountryGroup.bind(a)}}))}U.prototype.isInCountryGroup=function(a){var b=this,c=a.trim().split(/,\s*/);return c.filter((function(d){return 0<=b.A.indexOf(d)})).length!==c.length?1:0<c.filter((function(d){return 0<=b.j.indexOf(d)})).length?2:3};var Z=null;Z=new function(){var a=this;this.promise=new Promise((function(b,c){a.resolve=b;a.reject=c}))};AMP.registerElement("amp-geo",U);AMP.registerServiceForDoc("geo",(function(){return Z.promise}))}});//# sourceMappingURL=amp-geo-0.1.js.map